!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ngx-uploader",["exports","@angular/core","rxjs","rxjs/operators"],t):t((e=e||self)["ngx-uploader"]={},e.ng.core,e.rxjs,e.rxjs.operators)}(this,(function(e,t,n,r){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function i(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}var o={Queue:0,Uploading:1,Done:2,Cancelled:3};function s(e){if(0===e)return"0 Byte";var t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB","PB"][t]}o[o.Queue]="Queue",o[o.Uploading]="Uploading",o[o.Done]="Done",o[o.Cancelled]="Cancelled";var u=function(){function e(e,i,o,s){var u=this;void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===i&&(i=["*"]),void 0===o&&(o=Number.POSITIVE_INFINITY),void 0===s&&(s=Number.POSITIVE_INFINITY),this.queue=[],this.serviceEvents=new t.EventEmitter,this.uploadScheduler=new n.Subject,this.subs=[],this.contentTypes=i,this.maxUploads=o,this.maxFileSize=s,this.uploadScheduler.pipe(r.mergeMap((function(e){return u.startUpload(e)}),e)).subscribe((function(e){return u.serviceEvents.emit(e)}))}return e.prototype.handleFiles=function(e){var t,n=this,r=[].reduce.call(e,(function(e,t,r){var i=e.length+n.queue.length+1;if(n.isContentTypeAllowed(t.type)&&i<=n.maxUploads&&n.isFileSizeAllowed(t.size))e=e.concat(t);else{var o=n.makeUploadFile(t,r);n.serviceEvents.emit({type:"rejected",file:o})}return e}),[]);(t=this.queue).push.apply(t,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e}([].map.call(r,(function(e,t){var r=n.makeUploadFile(e,t);return n.serviceEvents.emit({type:"addedToQueue",file:r}),r})))),this.serviceEvents.emit({type:"allAddedToQueue"})},e.prototype.initInputEvents=function(e){var t=this;return e.subscribe((function(e){switch(e.type){case"uploadFile":var n=t.queue.findIndex((function(t){return t===e.file}));-1!==n&&e.file&&t.uploadScheduler.next({file:t.queue[n],event:e});break;case"uploadAll":t.queue.filter((function(e){return e.progress.status===o.Queue})).forEach((function(n){return t.uploadScheduler.next({file:n,event:e})}));break;case"cancel":var r=e.id||null;if(!r)return;t.subs.filter((function(e){return e.id===r})).forEach((function(e){if(e.sub){e.sub.unsubscribe();var n=t.queue.findIndex((function(e){return e.id===r}));-1!==n&&(t.queue[n].progress.status=o.Cancelled,t.serviceEvents.emit({type:"cancelled",file:t.queue[n]}))}}));break;case"cancelAll":t.subs.forEach((function(e){e.sub&&e.sub.unsubscribe();var n=t.queue.find((function(t){return t.id===e.id}));n&&(n.progress.status=o.Cancelled,t.serviceEvents.emit({type:"cancelled",file:n}))}));break;case"remove":if(!e.id)return;var i=t.queue.findIndex((function(t){return t.id===e.id}));if(-1!==i){var s=t.queue[i];t.queue.splice(i,1),t.serviceEvents.emit({type:"removed",file:s})}break;case"removeAll":t.queue.length&&(t.queue=[],t.serviceEvents.emit({type:"removedAll"}))}}))},e.prototype.startUpload=function(e){var t=this;return new n.Observable((function(n){var i=t.uploadFile(e.file,e.event).pipe(r.finalize((function(){n.closed||n.complete()}))).subscribe((function(e){n.next(e)}),(function(e){n.error(e),n.complete()}),(function(){n.complete()}));t.subs.push({id:e.file.id,sub:i})}))},e.prototype.uploadFile=function(e,t){var r=this;return new n.Observable((function(n){var i=t.url||"",u=t.method||"POST",a=t.data||{},p=t.headers||{},l=new XMLHttpRequest,d=(new Date).getTime(),c=e.progress.data&&e.progress.data.startTime||d,f=0,h=null;l.upload.addEventListener("progress",(function(t){if(t.lengthComputable){var i=Math.round(100*t.loaded/t.total),u=(new Date).getTime()-d;f=Math.round(t.loaded/u*1e3),c=e.progress.data&&e.progress.data.startTime||(new Date).getTime(),h=Math.ceil((t.total-t.loaded)/f),e.progress={status:o.Uploading,data:{percentage:i,speed:f,speedHuman:s(f)+"/s",startTime:c,endTime:null,eta:h,etaHuman:r.secondsToHuman(h)}},n.next({type:"uploading",file:e})}}),!1),l.upload.addEventListener("error",(function(e){n.error(e),n.complete()})),l.onreadystatechange=function(){if(l.readyState===XMLHttpRequest.DONE){var t=Math.round(e.size/((new Date).getTime()-c)*1e3);e.progress={status:o.Done,data:{percentage:100,speed:t,speedHuman:s(t)+"/s",startTime:c,endTime:(new Date).getTime(),eta:h,etaHuman:r.secondsToHuman(h||0)}},e.responseStatus=l.status;try{e.response=JSON.parse(l.response)}catch(t){e.response=l.response}e.responseHeaders=r.parseResponseHeaders(l.getAllResponseHeaders()),n.next({type:"done",file:e}),n.complete()}},l.open(u,i,!0),l.withCredentials=!!t.withCredentials;try{var v=e.nativeFile,m=r.queue.findIndex((function(e){return e.nativeFile===v}));r.queue[m].progress.status===o.Cancelled&&n.complete(),Object.keys(p).forEach((function(e){return l.setRequestHeader(e,p[e])}));var y=void 0;!1!==t.includeWebKitFormBoundary?(Object.keys(a).forEach((function(t){return e.form.append(t,a[t])})),e.form.append(t.fieldName||"file",v,v.name),y=e.form):y=v,r.serviceEvents.emit({type:"start",file:e}),l.send(y)}catch(e){n.complete()}return(function(){l.abort()})}))},e.prototype.secondsToHuman=function(e){return new Date(1e3*e).toISOString().substr(11,8)},e.prototype.generateId=function(){return Math.random().toString(36).substring(7)},e.prototype.setContentTypes=function(e){void 0!==e&&e instanceof Array?void 0!==e.find((function(e){return"*"===e}))?this.contentTypes=["*"]:this.contentTypes=e:this.contentTypes=["*"]},e.prototype.allContentTypesAllowed=function(){return void 0!==this.contentTypes.find((function(e){return"*"===e}))},e.prototype.isContentTypeAllowed=function(e){return!!this.allContentTypesAllowed()||void 0!==this.contentTypes.find((function(t){return t===e}))},e.prototype.isFileSizeAllowed=function(e){return!this.maxFileSize||e<=this.maxFileSize},e.prototype.makeUploadFile=function(e,t){return{fileIndex:t,id:this.generateId(),name:e.name,size:e.size,type:e.type,form:new FormData,progress:{status:o.Queue,data:{percentage:0,speed:0,speedHuman:s(0)+"/s",startTime:null,endTime:null,eta:null,etaHuman:null}},lastModifiedDate:new Date(e.lastModified),sub:void 0,nativeFile:e}},e.prototype.parseResponseHeaders=function(e){if(e)return e.split("\n").map((function(e){return e.split(/: */,2)})).filter((function(e){return e[0]})).reduce((function(e,t){return e[t[0]]=t[1],e}),{})},e}();var a=function(){function e(e){this.elementRef=e,this.stopEvent=function(e){e.stopPropagation(),e.preventDefault()},this.uploadOutput=new t.EventEmitter}return e.prototype.ngOnInit=function(){var e=this;this._sub=[];var n=this.options&&this.options.concurrency||Number.POSITIVE_INFINITY,r=this.options&&this.options.allowedContentTypes||["*"],i=this.options&&this.options.maxUploads||Number.POSITIVE_INFINITY,o=this.options&&this.options.maxFileSize||Number.POSITIVE_INFINITY;this.upload=new u(n,r,i,o),this.el=this.elementRef.nativeElement,this._sub.push(this.upload.serviceEvents.subscribe((function(t){e.uploadOutput.emit(t)}))),this.uploadInput instanceof t.EventEmitter&&this._sub.push(this.upload.initInputEvents(this.uploadInput)),this.el.addEventListener("drop",this.stopEvent,!1),this.el.addEventListener("dragenter",this.stopEvent,!1),this.el.addEventListener("dragover",this.stopEvent,!1)},e.prototype.ngOnDestroy=function(){this._sub.forEach((function(e){return e.unsubscribe()}))},e.prototype.onDrop=function(e){e.stopPropagation(),e.preventDefault();this.uploadOutput.emit({type:"drop"}),this.upload.handleFiles(e.dataTransfer.files)},e.prototype.onDragOver=function(e){if(e){this.uploadOutput.emit({type:"dragOver"})}},e.prototype.onDragLeave=function(e){if(e){this.uploadOutput.emit({type:"dragOut"})}},e.decorators=[{type:t.Directive,args:[{selector:"[ngFileDrop]"}]}],e.ctorParameters=function(){return[{type:t.ElementRef}]},e.propDecorators={options:[{type:t.Input}],uploadInput:[{type:t.Input}],uploadOutput:[{type:t.Output}],onDrop:[{type:t.HostListener,args:["drop",["$event"]]}],onDragOver:[{type:t.HostListener,args:["dragover",["$event"]]}],onDragLeave:[{type:t.HostListener,args:["dragleave",["$event"]]}]},e}();var p=function(){function e(e){var n=this;this.elementRef=e,this.fileListener=function(){n.el.files&&n.upload.handleFiles(n.el.files)},this.uploadOutput=new t.EventEmitter}return e.prototype.ngOnInit=function(){var e=this;this._sub=[];var n=this.options&&this.options.concurrency||Number.POSITIVE_INFINITY,r=this.options&&this.options.allowedContentTypes||["*"],i=this.options&&this.options.maxUploads||Number.POSITIVE_INFINITY,o=this.options&&this.options.maxFileSize||Number.POSITIVE_INFINITY;this.upload=new u(n,r,i,o),this.el=this.elementRef.nativeElement,this.el.addEventListener("change",this.fileListener,!1),this._sub.push(this.upload.serviceEvents.subscribe((function(t){e.uploadOutput.emit(t)}))),this.uploadInput instanceof t.EventEmitter&&this._sub.push(this.upload.initInputEvents(this.uploadInput))},e.prototype.ngOnDestroy=function(){this.el&&(this.el.removeEventListener("change",this.fileListener,!1),this._sub.forEach((function(e){return e.unsubscribe()})))},e.decorators=[{type:t.Directive,args:[{selector:"[ngFileSelect]"}]}],e.ctorParameters=function(){return[{type:t.ElementRef}]},e.propDecorators={options:[{type:t.Input}],uploadInput:[{type:t.Input}],uploadOutput:[{type:t.Output}]},e}();var l=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{declarations:[a,p],exports:[a,p]}]}],e}();e.NgFileDropDirective=a,e.NgFileSelectDirective=p,e.NgUploaderService=u,e.NgxUploaderModule=l,e.UploadStatus=o,e.humanizeBytes=s,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-uploader.umd.min.js.map